const e=new class{constructor(){this.state=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],this.score=0,this.status="idle",this.moved=!1,this.nextCellId=1}getState(){return this.state}getScore(){return this.score}getStatus(){return this.status}moveLeft(){let e=this.state.map(e=>e.map(e=>e?{...e}:null)),t=[];this.moved=!1;for(let l=0;l<e.length;l++){let n=[!1,!1,!1,!1];for(let s=0;s<e[l].length;s++){if(null===e[l][s])continue;let r=s;for(;r>0&&null===e[l][r-1];)r--;r!==s&&(e[l][r]=e[l][s],e[l][s]=null,this.moved=!0,t.push({id:e[l][r].id,type:"move",from:[l,s],to:[l,r]})),r>0&&null!==e[l][r-1]&&e[l][r].value===e[l][r-1].value&&!n[r-1]&&(t.push({id:e[l][r].id,type:"merge",from:[l,r],to:[l,r-1],mergeIntoId:e[l][r-1].id}),e[l][r-1].value*=2,this.score+=e[l][r-1].value,e[l][r]=null,n[r-1]=!0,this.moved=!0)}}return{newState:e,transitions:t,moved:this.moved}}moveRight(){let e=this.state.map(e=>e.map(e=>e?{...e}:null)),t=[];this.moved=!1;for(let l=0;l<e.length;l++){let n=[!1,!1,!1,!1];for(let s=e[l].length-1;s>=0;s--){if(null===e[l][s])continue;let r=s;for(;r<e[l].length-1&&null===e[l][r+1];)r++;r!==s&&(e[l][r]=e[l][s],e[l][s]=null,this.moved=!0,t.push({id:e[l][r].id,type:"move",from:[l,s],to:[l,r]})),r<e[l].length-1&&null!==e[l][r+1]&&e[l][r].value===e[l][r+1].value&&!n[r+1]&&(t.push({id:e[l][r].id,type:"merge",from:[l,r],to:[l,r+1],mergeIntoId:e[l][r+1].id}),e[l][r+1].value*=2,this.score+=e[l][r+1].value,e[l][r]=null,n[r+1]=!0,this.moved=!0)}}return{newState:e,transitions:t,moved:this.moved}}moveUp(){let e=this.state.map(e=>e.map(e=>e?{...e}:null)),t=[];this.moved=!1;for(let l=0;l<e[0].length;l++){let n=[!1,!1,!1,!1];for(let s=0;s<e.length;s++){if(null===e[s][l])continue;let r=s;for(;r>0&&null===e[r-1][l];)r--;r!==s&&(e[r][l]=e[s][l],e[s][l]=null,this.moved=!0,t.push({id:e[r][l].id,type:"move",from:[s,l],to:[r,l]})),r>0&&null!==e[r-1][l]&&e[r][l].value===e[r-1][l].value&&!n[r-1]&&(t.push({id:e[r][l].id,type:"merge",from:[r,l],to:[r-1,l],mergeIntoId:e[r-1][l].id}),e[r-1][l].value*=2,this.score+=e[r-1][l].value,e[r][l]=null,n[r-1]=!0,this.moved=!0)}}return{newState:e,transitions:t,moved:this.moved}}moveDown(){let e=this.state.map(e=>e.map(e=>e?{...e}:null)),t=[];this.moved=!1;for(let l=0;l<e[0].length;l++){let n=[!1,!1,!1,!1];for(let s=e.length-1;s>=0;s--){if(null===e[s][l])continue;let r=s;for(;r<e.length-1&&null===e[r+1][l];)r++;r!==s&&(e[r][l]=e[s][l],e[s][l]=null,this.moved=!0,t.push({id:e[r][l].id,type:"move",from:[s,l],to:[r,l]})),r<e.length-1&&null!==e[r+1][l]&&e[r][l].value===e[r+1][l].value&&!n[r+1]&&(t.push({id:e[r][l].id,type:"merge",from:[r,l],to:[r+1,l],mergeIntoId:e[r+1][l].id}),e[r+1][l].value*=2,this.score+=e[r+1][l].value,e[r][l]=null,n[r+1]=!0,this.moved=!0)}}return{newState:e,transitions:t,moved:this.moved}}defineStep([e,t],l){let n=this.state[e][t],s=this.state[e],r=this.state.map(e=>e[t]),o=0;switch(l){case"left":for(let e=t-1;e>=0;e--)if(0===s[e])o++;else if(s[e]===n)return o+1;else break;return o;case"right":for(let e=t+1;e<s.length;e++)if(0===s[e])o++;else if(s[e]===n)return o+1;else break;return o;case"up":for(let t=e-1;t>=0;t--)if(0===r[t])o++;else if(r[t]===n)return o+1;else break;return o;case"down":for(let t=e+1;t<r.length;t++)if(0===r[t])o++;else if(r[t]===n)return o+1;else break;return o}}start(){this.born(),this.born(),this.status="playing"}restart(){this.state=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]],this.status="idle",this.score=0,this.nextCellId=1}check(){for(let e=0;e<this.state.length;e++)for(let t=0;t<this.state[e].length;t++){let l=this.state[e][t];if(null!==l&&l.value>=2048){this.status="win";return}if(!l)return;if(t<this.state[e].length-1){let n=this.state[e][t+1];if(null!==n&&n.value===l.value)return}if(e<this.state.length-1){let n=this.state[e+1][t];if(null!==n&&n.value===l.value)return}}this.status="lose"}born(){let e=[];for(let t=0;t<4;t++)for(let l=0;l<4;l++)null===this.state[t][l]&&e.push([t,l]);if(0===e.length)return;let[t,l]=e[Math.floor(Math.random()*e.length)],n=.1>Math.random()?4:2,s={id:this.nextCellId++,value:n};return this.state[t][l]=s,{id:s.id,type:"spawn",to:[t,l],value:n}}performMove(e){let t;switch(e){case"LEFT":t=this.moveLeft();break;case"RIGHT":t=this.moveRight();break;case"UP":t=this.moveUp();break;case"DOWN":t=this.moveDown();break;default:return{newState:this.state,transitions:[],moved:!1}}if(t.moved){this.state=t.newState;let e=this.born();t.transitions.push(e),this.check()}return t}},t=document.querySelector(".button"),l=document.querySelector(".game-field");Z;const n=document.querySelector(".game-score"),s=document.querySelector(".best-score"),r=document.querySelector(".message-start"),o=document.querySelector(".message-win"),i=document.querySelector(".message-lose");let a=!0;function u(t){if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)&&t.preventDefault(),"playing"===e.status&&a){let r;let u=null;"keydown"===t.type&&t.key&&["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(t.key)&&(u=t.key.replace("Arrow","").toUpperCase()),["LEFT","RIGHT","UP","DOWN"].includes(u)&&(r=e.performMove(u)).moved&&(a=!1,r.transitions.forEach(e=>{let t=document.getElementById(`cell-${e.id}`);t&&("move"===e.type||"merge"===e.type)&&(t.style.transform=`translate(${83*e.to[1]}px, ${83*e.to[0]}px)`)}),setTimeout(()=>{r.transitions.forEach(t=>{if("merge"===t.type){let l=document.getElementById(`cell-${t.id}`),n=document.getElementById(`cell-${t.mergeIntoId}`);if(l&&l.remove(),n){let l=e.state[t.to[0]][t.to[1]],s=l?l.value:0;n.textContent=s,n.className=`cell cell--${n.textContent}`}}if("spawn"===t.type){let e=d(t.value,t.to[0],t.to[1],t.id);l.appendChild(e)}}),n.textContent=e.getScore(),e.getScore()>parseInt(s.textContent)&&(s.textContent=e.getScore(),localStorage.setItem("bestScore",e.getScore())),"lose"===e.status&&i.classList.remove("hidden"),"win"===e.status&&o.classList.remove("hidden"),a=!0},100))}}function d(e,t,l,n){let s=document.createElement("div");return s.id=`cell-${n}`,s.className=`cell cell--${e}`,s.textContent=e,s.style.transform=`translate(${83*l}px, ${83*t}px)`,s}s.textContent=localStorage.getItem("bestScore")||0,t.addEventListener("click",()=>{("idle"===e.status||(e.restart(),l.querySelectorAll(".cell").forEach(e=>e.remove()),t.textContent="Start",t.classList.remove("restart"),t.classList.add("start"),n.textContent=e.getScore(),r.classList.remove("hidden"),i.classList.add("hidden"),o.classList.add("hidden"),document.removeEventListener("keydown",u),"idle"!==e.status||"Start"!==t.textContent))&&"Start"===t.textContent&&(e.start(),t.textContent="Restart",t.classList.remove("start"),t.classList.add("restart"),r.classList.add("hidden"),function(e){for(let t=0;t<e.length;t++)for(let n=0;n<e[t].length;n++){let s=e[t][n],r=s?s.value:0;if(0!==r){let e=d(r,t,n,s.id);l.appendChild(e)}}}(e.getState()),n.textContent=e.getScore(),document.addEventListener("keydown",u))});
//# sourceMappingURL=index.6c63ed25.js.map
